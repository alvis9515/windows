---
- name: Comprobar y reiniciar un servicio
  hosts: all
  tasks:
    - name: Comprobar el estado de los servicios
      win_service:
        names: "{{ service_names }}"
      register: services_info

    - name: Reiniciar servicios detenidos
      win_service:
        name: "{{ item.name }}"
        state: started
      loop: "{{ services_info.services }}"
      when: "'Stopped' in item.state"
